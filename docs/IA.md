# IA (Information Architecture)
# 노마(Noma) 정보 아키텍처

---

## 1. 사이트맵

```
노마(Noma) 복지 내비게이터
│
├── 🏠 메인 (/) ──→ code.html
│   │
│   ├── [헤더] ─────────────────────────────────────────────
│   │   ├── 로고 (PASS + 경상남도사회서비스원)
│   │   ├── GNB (데스크톱)
│   │   │   ├── 전체 서비스 → #browse-section 스크롤
│   │   │   ├── 자주 묻는 질문 (예정)
│   │   │   ├── 내 서랍 → 서랍 패널 열기
│   │   │   └── 전화 문의 → tel:0552308200
│   │   └── 모바일 메뉴 (햄버거)
│   │       └── 동일 메뉴 항목
│   │
│   ├── [히어로] ────────────────────────────────────────────
│   │   ├── 타이틀 + 서브타이틀
│   │   ├── 검색 입력창
│   │   │   ├── 마이크 버튼 (STT)
│   │   │   ├── 텍스트 입력
│   │   │   └── 전송 버튼
│   │   └── 예시 칩 (프리셋 검색어 4개)
│   │       ├── "#퇴원 후 돌봄이 필요해요"
│   │       ├── "#스마트 건강관리"
│   │       ├── "#긴급 돌봄"
│   │       └── "#독거 어르신 안전"
│   │
│   ├── [검색 결과] (검색 후 표시) ──────────────────────────
│   │   ├── AI 응답 요약 (마크다운 렌더링)
│   │   ├── 인라인 상담 신청 카드 (대화형 신청 완료 시)
│   │   │   ├── 성공: 초록색 확인 카드 (신청자명, 서비스명, 연락처)
│   │   │   └── 실패: 빨간색 에러 카드 (카드 버튼 사용 안내)
│   │   ├── 추천 서비스 카드 (최대 5개)
│   │   │   └── Stepper 카드 (상세 → 아래 참조)
│   │   ├── 새로 질문하기 버튼
│   │   └── 추가 안내
│   │       ├── "전체 서비스 둘러보기" 버튼
│   │       └── "대표전화 055-230-8200" 버튼
│   │
│   ├── [초기 플레이스홀더] (검색 전 표시) ──────────────────
│   │   └── 카테고리 미리보기 카드 3개
│   │       ├── 긴급돌봄 지원
│   │       ├── AI 스마트 돌봄
│   │       └── 장애인 지원 서비스
│   │
│   ├── [전체 서비스 브라우징] ───────────────────────────────
│   │   ├── 카테고리 탭
│   │   │   ├── 공공돌봄 (n건)
│   │   │   ├── 민간지원 (n건)
│   │   │   └── 국공립시설 (n건)
│   │   └── 서비스 리스트
│   │       └── 서비스 항목 (클릭 → 상세 펼침)
│   │           ├── 서비스명 + 요약
│   │           ├── [펼침] 지원 대상
│   │           ├── [펼침] 지원 내용
│   │           ├── [펼침] 신청 방법
│   │           ├── [펼침] 문의처
│   │           ├── [펼침] 상담 신청 버튼
│   │           └── 북마크 버튼
│   │
│   ├── [서비스 이용 경로] ──────────────────────────────────
│   │   ├── ① 상담 및 신청
│   │   ├── ② 자격 확인
│   │   ├── ③ 전담 인력 배정
│   │   └── ④ 서비스 제공
│   │
│   └── [푸터] ──────────────────────────────────────────────
│       ├── 기관 정보 (주소, 대표전화)
│       └── 링크 (개인정보처리방침, 이용약관, 사이트맵)
│
├── 🎤 플로팅 마이크 (모바일, 화면 우하단 고정)
│   └── 탭 → 음성 입력 시작/정지
│
├── 📋 내 서랍 패널 (우측 슬라이드)
│   ├── 저장된 서비스 목록
│   │   └── 서비스 항목
│   │       ├── 서비스명 + 요약 + 담당 기관
│   │       ├── 상담 신청 버튼
│   │       └── 삭제 버튼
│   ├── 전체 비우기 버튼
│   └── 빈 상태: "아직 담아둔 서비스가 없어요"
│
├── 📝 상담 신청 모달 (카드 버튼 경로)
│   ├── Step 1: 성함 입력
│   ├── Step 2: 연락처 입력
│   ├── Step 3: 신청 완료 확인 (4초 후 자동 복귀)
│   └── Step 4: 오류 안내
│
├── 💬 대화형 상담 신청 (음성/텍스트 대화 경로)
│   ├── AI가 서비스 확인 → 성함 질문 → 전화번호 질문
│   ├── <noma-apply> 태그 → 자동 POST /api/service-request/connect
│   ├── 성공: 인라인 초록색 확인 카드
│   └── 실패: 인라인 빨간색 에러 카드 (카드 버튼 안내)
│
├── 📧 서비스 연계 요청 페이지 (/referral/:requestId)
│   ├── 원래 상담 요청 정보 표시
│   ├── 연계 대상 서비스 선택 (카테고리별 드롭다운)
│   ├── 연계 사유 입력
│   └── 연계 이메일 발송 → 연쇄 연계 지원
│
├── 🔒 동의 모달 (첫 북마크 시)
│   ├── "서비스를 저장할까요?" 안내
│   ├── "네, 저장할게요" → 동의 후 저장
│   └── "괜찮아요" → 취소
│
├── 🔐 관리자 대시보드 (/admin) ──→ admin.html
│   │
│   ├── [로그인 게이트] ──────────────────────────────────────
│   │   ├── 관리자 로그인 아이콘 + 타이틀
│   │   ├── 비밀번호 입력 + 로그인 버튼
│   │   └── 에러 메시지 표시
│   │
│   ├── [사이드바] (인증 후 표시) ────────────────────────────
│   │   ├── 로고 (관리자 대시보드 / 경상남도사회서비스원)
│   │   ├── 네비게이션
│   │   │   ├── 현황판 (monitoring)
│   │   │   ├── 상담 요청 (list_alt)
│   │   │   ├── 분석 (analytics)
│   │   │   └── 연계 조정 (hub) + 뱃지
│   │   └── 메인으로 (home) ──→ /
│   │
│   ├── [탑바] ───────────────────────────────────────────────
│   │   ├── 모바일 사이드바 토글 (햄버거)
│   │   ├── 현재 탭 타이틀
│   │   └── 현재 시간
│   │
│   ├── [Tab 1: 현황판] (panel-dashboard) ────────────────────
│   │   ├── KPI 카드 (2x2 또는 4열 그리드)
│   │   │   ├── 총 접수 (inbox)
│   │   │   ├── 처리 중 (pending_actions)
│   │   │   ├── 연계 활성 (hub)
│   │   │   └── 완료율 (task_alt)
│   │   ├── 칸반 보드 (5컬럼)
│   │   │   ├── 접수 (open) - 파란색
│   │   │   ├── 확인 (confirmed) - 노란색
│   │   │   ├── 연락 (contacted) - 보라색
│   │   │   ├── 연결 (connected) - 청록색
│   │   │   └── 완료 (closed) - 초록색
│   │   │   └── 각 컬럼: 카드(클릭→확장) + 카운트 뱃지
│   │   │       └── 확장 시: 상세정보 + 메모 + 상태변경 + 연계체인
│   │   └── 14일 접수 추이 막대 차트 (Chart.js)
│   │
│   ├── [Tab 2: 상담 요청] (panel-requests) ──────────────────
│   │   ├── 필터 바
│   │   │   ├── 상태 드롭다운 (전체/접수/확인/연락/연결/완료/연계)
│   │   │   ├── 검색 입력 (이름/전화/서비스)
│   │   │   └── 정렬 토글 (최신/오래된)
│   │   ├── 요청 테이블 (zebra striping)
│   │   │   └── 행: 서비스명 + 신청자 + 연락처 + 접수일 + 상태배지 + 보기버튼
│   │   ├── 페이지네이션
│   │   └── 상세 모달 (보기 클릭 시)
│   │       ├── 대상자 정보 (서비스, 이름, 전화, 접수일)
│   │       ├── 상태 변경 드롭다운 + 변경 버튼
│   │       ├── AI 대화 요약
│   │       ├── 메모 섹션 (목록 + 입력 + 추가)
│   │       ├── 연계 체인
│   │       ├── 서비스 계획 수립 (단계 추가/삭제/저장)
│   │       └── 닫기 버튼
│   │
│   ├── [Tab 3: 분석] (panel-analytics) ──────────────────────
│   │   ├── KPI 요약 카드 (검색 수, 신청 수, TTS 사용 수)
│   │   ├── 서비스 인기도 막대 차트 (가로)
│   │   ├── 카테고리 분포 도넛 차트
│   │   └── 일별 이벤트 추이 라인 차트 (7/14/30일 전환)
│   │
│   └── [Tab 4: 연계 조정] (panel-collab) ────────────────────
│       ├── 승인 대기 목록 (부서 승인 + 관리자 승인)
│       │   └── 각 항목
│       │       ├── 사건 정보 (서비스명, 신청자, 접수일)
│       │       ├── 연계 유형 (자문/공동처리/이관/서비스연계) + 카테고리
│       │       ├── 요청 부서 → 대상 부서/서비스
│       │       ├── 사유
│       │       ├── 승인 타임라인
│       │       │   ├── 담당자 제출 (일시)
│       │       │   ├── 부서 조정자 처리 (일시 + 코멘트)
│       │       │   └── 관리자 최종 처리 (일시 + 코멘트)
│       │       └── 액션 버튼 (승인/반려/수정요청 + 코멘트 입력)
│       └── 활성 협업 목록
│           └── 상태별 필터링 (요청/수락/완료/거절)
│
├── 📋 상담 처리 페이지 (/case/:requestId) ──→ case.html
│   │
│   ├── [로그인 게이트] ──────────────────────────────────────
│   │   ├── 담당자 인증 아이콘 + 타이틀
│   │   ├── 비밀번호 입력 + 로그인 버튼
│   │   └── 에러 메시지 표시
│   │
│   ├── [로딩 상태] (인증 후) ─────────────────────────────────
│   │   └── 스피너 + "상담 정보를 불러오는 중..."
│   │
│   ├── [404 에러 상태] ───────────────────────────────────────
│   │   └── 에러 아이콘 + "요청을 찾을 수 없습니다"
│   │
│   └── [메인 콘텐츠] (데이터 로드 후) ────────────────────────
│       ├── A. 헤더 (녹색 그라데이션)
│       │   └── 아이콘 + "상담 처리" + 안내 문구
│       │
│       ├── B. 대상자 정보
│       │   ├── 신청 서비스
│       │   ├── 성함
│       │   ├── 연락처
│       │   ├── 접수일
│       │   └── 현재 상태 (배지)
│       │
│       ├── C. AI 대화 요약 (존재 시)
│       │   └── 보라색 카드: AI 요약 텍스트
│       │
│       ├── D. 상태 진행 스테퍼
│       │   ├── 5단계 원형 (done/current/future)
│       │   │   ├── 접수(open) → 확인(confirmed) → 연락(contacted)
│       │   │   └── → 연결(connected) → 완료(closed)
│       │   └── "다음 단계로" 버튼 (current 단계에만)
│       │
│       ├── E. 처리 메모
│       │   ├── 메모 목록 (시간순, 250px 스크롤)
│       │   └── 입력 + 추가 버튼
│       │
│       ├── F. 서비스 계획 뷰어 (관리자가 수립한 계획, 읽기 전용)
│       │   └── 단계별 뱃지 리스트
│       │
│       ├── G. 통합 연계 요청
│       │   ├── 기존 연계 목록
│       │   │   └── 각 항목
│       │   │       ├── 유형 아이콘 + 라벨 (자문/공동처리/이관/서비스연계)
│       │   │       ├── 대상 (부서명 또는 서비스명)
│       │   │       ├── 승인 상태 배지 (7종)
│       │   │       │   ├── 부서 검토 대기 (pending)
│       │   │       │   ├── 부서 승인 - 최종 대기 (dept_approved)
│       │   │       │   ├── 최종 승인 (approved)
│       │   │       │   ├── 부서 반려 (rejected)
│       │   │       │   ├── 부서 수정 요청 (revision_requested)
│       │   │       │   ├── 관리자 반려 (admin_rejected)
│       │   │       │   └── 관리자 수정 요청 (admin_revision_requested)
│       │   │       ├── 실행 상태 (발송완료/진행중/완료/거절)
│       │   │       ├── 메모 목록
│       │   │       └── 재제출 버튼 (반려/수정요청 시)
│       │   └── 새 연계 요청 폼 (토글)
│       │       ├── 카테고리 탭: 부서 협업 / 서비스 연계
│       │       ├── [부서 협업] 우리팀(from) + 대상팀(to) + 유형(자문/공동처리/이관)
│       │       ├── [서비스 연계] 대상 서비스 드롭다운
│       │       ├── 사유 입력
│       │       ├── 요청 보내기 / 취소 버튼
│       │       └── "관리자 승인 후 실행됩니다" 안내
│       │
│       ├── H. 배정 근거
│       │   ├── 담당 부서 정보 (부서명, 역할)
│       │   └── AI 배정 분석 (법적·제도적·실무적 근거)
│       │
│       ├── I. AI 상담 (업무 지원)
│       │   ├── 역할 선택 (담당자/부서 조정자/관리자 조정자/타부서 담당자/타부서 조정자)
│       │   ├── 빠른 질문 버튼 4종
│       │   │   ├── 배정 근거
│       │   │   ├── 처리 방안
│       │   │   ├── 연계 필요성
│       │   │   └── 보고 요약
│       │   ├── 대화 영역 (400px 스크롤)
│       │   └── 자유 입력 (의견 제시, 반론 가능)
│       │
│       ├── J. 연계 체인 (연쇄 연계 이력)
│       │   └── 체인 아이템 목록 (서비스명 → 서비스명 연결선)
│       │
│       └── K. 대상자 전화 버튼
│           └── tel: 링크로 바로 전화
│
└── 📧 서비스 연계 요청 페이지 (/referral/:requestId) ──→ referral.html
    ├── 원래 상담 요청 정보 표시
    ├── 연계 대상 서비스 선택
    ├── 연계 사유 입력
    └── 연계 이메일 발송 → 연쇄 연계 지원
```

---

## 2. 추천 서비스 카드 (Stepper) 상세 구조

```
┌─────────────────────────────────────────┐
│  [아이콘]                    [북마크]   │
│                                         │
│  서비스명 (h3, bold)                     │
│  한 줄 요약 (summary)                    │
│                                         │
│  ─── Stepper Timeline ───               │
│                                         │
│  ① ── 대상 확인 ──────────── ▼ (펼침)   │
│  │    "65세 이상 독거노인,              │
│  │     장애인, 한부모가정 등"            │
│  │                                      │
│  ② ── 신청 방법 ──────────── ▶ (접힘)   │
│  │                                      │
│  ③ ── 받는 혜택 ──────────── ▶ (접힘)   │
│  │                                      │
│  ④ ── 연락처 ────────────── ▶ (접힘)    │
│       [전화 055-230-8200]  ← tel: 링크  │
│                                         │
│  ┌─────────────────────────────────┐    │
│  │    이 서비스 상담 신청            │    │
│  └─────────────────────────────────┘    │
│  "버튼을 누르면 담당 기관에 정보가       │
│   전달되며, 2~3일 내 전화 연락드립니다"  │
└─────────────────────────────────────────┘
```

---

## 3. 화면 전환 흐름 (Screen Flow)

### 3.1 도민 흐름 (code.html)

```
[초기 상태]                    [검색 결과 상태]
┌──────────────┐              ┌──────────────┐
│   헤더       │              │   헤더       │
│              │              │              │
│   히어로     │   검색 실행   │ 히어로(축소) │
│  (검색창)    │ ──────────→  │  (검색창)    │
│  (예시 칩)   │              │              │
│              │              │  AI 요약     │
│  플레이스홀더 │              │  Stepper카드 │
│  (3개 미리보기)│             │  추가 안내    │
│              │              │              │
│  전체 서비스  │              │  전체 서비스  │
│  이용 경로   │  ←────────── │  이용 경로   │
│  푸터        │  새로 질문하기 │  푸터        │
└──────────────┘              └──────────────┘
                                    │
                               카드 클릭
                                    │
                                    ▼
                              ┌──────────────┐
                              │  상담 신청    │
                              │  모달         │
                              │  ① 이름      │
                              │  ② 전화번호   │
                              │  ③ 완료      │
                              └──────────────┘

[대화형 신청 흐름 (카드 버튼 대신 대화로 신청)]

┌──────────────┐     이름 답변     ┌──────────────┐
│ AI 요약      │ ──────────────→  │ AI 요약      │
│ 서비스 카드   │     전화번호 답변  │ + 인라인     │
│ "신청할게요"  │ ──────────────→  │   확인 카드   │
└──────────────┘                  └──────────────┘
      │                                  │
 AI가 이름 질문                    <noma-apply> 자동 처리
 AI가 전화번호 질문                 → 이메일 발송
                                  → 초록 확인 카드 표시
```

### 3.2 관리자 흐름 (admin.html)

```
┌──────────────┐     비밀번호      ┌──────────────────────────────────────┐
│  로그인 게이트 │ ──────────────→  │  사이드바  │  메인 콘텐츠             │
│  (비밀번호)   │     인증 성공     │           │                         │
└──────────────┘                  │  현황판 ✓  │  [KPI 카드 4종]          │
                                  │  상담 요청  │  [칸반 보드 5컬럼]       │
                                  │  분석      │  [14일 추이 차트]        │
                                  │  연계 조정  │                         │
                                  └───────────┴──────────────────────────┘
                                       │                │
                                  탭 전환          칸반 카드 클릭
                                       │                │
                                       ▼                ▼
                                  각 탭 패널       카드 확장 (상세)
                                       │           ├── 상세정보
                                       │           ├── 메모
                                  연계 조정 탭      ├── 상태변경
                                       │           └── 연계체인
                                       ▼
                                  ┌──────────────┐
                                  │ 승인 대기 목록 │
                                  │ ├── 부서 승인  │
                                  │ └── 관리자 승인 │
                                  │              │
                                  │ [승인/반려/수정]│
                                  │ + 코멘트 입력  │
                                  └──────────────┘
```

### 3.3 담당자 흐름 (case.html)

```
┌──────────────┐     비밀번호      ┌──────────────┐
│  로그인 게이트 │ ──────────────→  │  로딩 스피너  │
│  (비밀번호)   │     인증 성공     └──────┬───────┘
└──────────────┘                         │
                                    데이터 로드
                                         │
                                         ▼
                              ┌──────────────────┐
                              │ 상담 처리         │
                              │ ┌── 대상자 정보    │
                              │ ├── AI 대화 요약   │
                              │ ├── 상태 스테퍼    │ ←── 다음 단계 버튼
                              │ ├── 처리 메모      │ ←── 메모 추가
                              │ ├── 서비스 계획    │
                              │ ├── 연계 요청      │ ←── 새 연계 생성
                              │ ├── 배정 근거      │
                              │ ├── AI 상담       │ ←── 업무 질의
                              │ ├── 연계 체인      │
                              │ └── 전화 버튼      │
                              └──────────────────┘
```

### 3.4 2단계 승인 흐름

```
[담당자 case.html]          [부서 조정자 admin.html]         [관리자 admin.html]
                             연계 조정 탭                     연계 조정 탭
┌───────────┐              ┌──────────────┐               ┌──────────────┐
│ 연계 요청  │  pending     │ 승인 대기     │  dept_approved │ 승인 대기     │
│ 생성      │ ──────────→  │ (부서 검토)   │ ────────────→ │ (최종 검토)   │
└───────────┘              │              │               │              │
      ▲                    │ ┌── 승인 ───┐│               │ ┌── 승인 ───┐│
      │                    │ ├── 반려    ││               │ ├── 반려    ││
  재제출                    │ └── 수정요청 ┘│               │ └── 수정요청 ┘│
      │                    └──────────────┘               └──────┬───────┘
      │                         │                                │
      │              rejected/  │                    approved    │
      │          revision_req   │                                │
      └─────────────────────────┘                                │
      │                                                          │
      │              admin_rejected/                              │
      │          admin_revision_req                               │
      └──────────────────────────────────────────────────────────┘
                                                                 │
                                                          approved (최종)
                                                                 │
                                                                 ▼
                                                        이메일 자동 발송
                                                        (연계 대상 기관)
```

---

## 4. 데이터 구조

### 4.1 지식베이스 (CSV → 메모리)

```
welfareKB[]
├── 대분류:    공공돌봄 | 민간지원 | 국공립시설
├── 중분류:    서비스 하위 분류
├── 소분류:    세부 분류 (대부분 "분류없음")
├── 사업명:    서비스 공식 명칭        ← RAG 가중치 3
├── 키워드 태그: 검색용 해시태그       ← RAG 가중치 2
├── 지원 대상:  자격 요건 설명         ← RAG 가중치 1
├── 지원 내용:  혜택 상세 설명         ← RAG 가중치 1
├── 신청 방법:  신청 절차 안내
├── 문의처:    전화번호 + 부서명
└── 출처 URL:  공식 문서 링크
```

### 4.2 부서별 사업 프로파일 (deptServiceMap)

```
deptServiceMap = {
  "사업명": {
    dept:            "담당 부서",
    responsibility:  "주요 책임",
    basis:           "법적 근거",
    targetGroup:     "대상 그룹",
    keyEligibility:  ["자격 요건 배열"],
    referralTargets: ["연계 가능 서비스"],
  }
}
```

### 4.3 클라이언트 상태 (code.html)

```
SessionStorage (5분 만료)
├── nomaChatHistory:     대화 메시지 배열 (최대 8개)
└── nomaChatLastActive:  마지막 활동 타임스탬프

LocalStorage (영구)
├── nomaDrawerConsent:   서랍 사용 동의 여부
└── nomaDrawerItems:     저장된 서비스 배열
    └── [{ serviceName, summary, agency, savedAt }]
```

### 4.4 요청 데이터 (requestStore - JSON 파일)

```
requests.json = {
  "requestId": {
    id:                  "고유 ID",
    serviceName:         "신청 서비스명",
    userName:            "신청자 이름",
    userPhone:           "전화번호",
    status:              "open|confirmed|contacted|connected|closed|referred",
    createdAt:           "접수일 (한국어 형식)",
    createdAtISO:        "ISO 타임스탬프",
    updatedAt:           "최종 수정일",
    conversationSummary: "AI 대화 요약",
    assignmentRationale: "AI 배정 근거",
    chatHistory:         [대화 기록 배열],
    notes:               [{ text, author, timestamp }],
    linkages:            [연계 배열 → 4.5 참조],
    servicePlan:         { steps: ["단계1", "단계2", ...] },
    referredFrom:        "연계 출처 요청 ID",
  }
}
```

### 4.5 연계/협업 데이터 (linkages)

```
linkage = {
  id:              "고유 ID",
  category:        "collaboration|referral",
  type:            "consultation|joint|transfer|service_referral",
  fromDept:        "요청 부서 ID (협업)",
  toDept:          "대상 부서 ID (협업)",
  targetService:   "대상 서비스명 (연계)",
  reason:          "사유",
  submittedBy:     "제출자",
  approvalStatus:  "pending|dept_approved|approved|rejected|revision_requested|admin_rejected|admin_revision_requested",
  executionStatus: "pending|email_sent|in_progress|completed|declined",
  approvalHistory: [
    { action, by, comment, at }  // 승인 이력
  ],
  notes:           [{ text, author, dept, timestamp }],
  createdAt:       "ISO 타임스탬프",
}
```

### 4.6 분석 데이터 (analyticsStore - JSON 파일)

```
analytics.json = {
  "YYYY-MM-DD": {
    searches:           검색 수,
    serviceRequests:    상담 신청 수,
    ttsRequests:        TTS 요청 수,
    referrals:          연계 요청 수,
    voiceSearches:      음성 검색 수,
  }
}
```

### 4.7 부서 목록 (DEPARTMENTS)

```
DEPARTMENTS = [
  { id: "dept-1", name: "경영지원과", type: "department" },
  { id: "dept-2", name: "전략기획과", type: "department" },
  ...
  { id: "fac-1",  name: "경상남도청어린이집", type: "facility" },
  ...
]
```

### 4.8 API 데이터 흐름

```
[사용자 입력]
     │
     ▼
"몸이 아파요"
     │
     ▼ split + stripKoreanSuffixes
["아파"]
     │
     ▼ expandSearchTerms (synonymMap)
["아파"] + 확장: ["질병","부상","돌봄","의료","긴급돌봄"]
     │
     ▼ 스코어링 (사업명x3, 키워드x2, 대상x1, 내용x1, 확장x0.7)
┌──────────────────────────────┬────────┐
│ 긴급돌봄지원사업              │ 11.9점 │
│ 창원시/김해시 종합재가센터     │  8.4점 │
│ 경상남도통합돌봄지원센터       │  7.7점 │
│ AI 온하나케어 스마트 돌봄      │  4.9점 │
│ 노인맞춤돌봄지원 광역관리      │  4.2점 │
└──────────────────────────────┴────────┘
     │
     ▼ Gemini AI (시스템 프롬프트 + RAG 컨텍스트)
     │
     ▼ SSE 스트리밍 → 텍스트 + <noma-card> JSON + <noma-apply> JSON
     │
     ▼ 파싱 → AI 요약 렌더링 + Stepper 카드 렌더링
     │
     ▼ parseNomaApply() → 자동 신청 POST → 인라인 확인/에러 카드
     │
     ▼ requestStore 저장 + AI 대화 요약/배정 근거 생성 + 이메일 발송
     │
     ▼ 담당자 이메일 수신 → case.html 링크 → 상담 처리
     │
     ▼ 연계 필요 시 → linkage 생성 → 2단계 승인 → 이메일 발송
```

---

## 5. 네비게이션 구조

### 5.1 code.html GNB (Global Navigation Bar)

| 메뉴 | 동작 | 위치 |
|------|------|------|
| 전체 서비스 | 브라우징 섹션으로 스크롤 | 헤더 |
| 자주 묻는 질문 | (예정) | 헤더 |
| 내 서랍 (뱃지) | 우측 서랍 패널 열기 | 헤더 |
| 전화 문의 | `tel:0552308200` 전화 연결 | 헤더 |

### 5.2 code.html 컨텍스트 네비게이션

| 트리거 | 목적지 | 발생 위치 |
|--------|-------|----------|
| 예시 칩 클릭 | 해당 쿼리로 검색 실행 | 히어로 |
| 플레이스홀더 카드 클릭 | 해당 키워드로 검색 실행 | 초기 화면 |
| "전체 서비스 둘러보기" | 브라우징 섹션 스크롤 | 검색 결과 하단 |
| "새로 질문하기" | 초기 상태로 리셋 | 검색 결과 상단 |
| 카드 "상담 신청" | 상담 신청 모달 열기 | 서비스 카드 |
| 카드 "북마크" | 내 서랍에 저장 | 서비스 카드 |
| 전화번호 탭 | 전화 앱 연결 | 카드 연락처 단계 |

### 5.3 admin.html 사이드바 네비게이션

| 메뉴 | 탭 ID | 아이콘 | 뱃지 |
|------|-------|--------|------|
| 현황판 | panel-dashboard | monitoring | - |
| 상담 요청 | panel-requests | list_alt | - |
| 분석 | panel-analytics | analytics | - |
| 연계 조정 | panel-collab | hub | 승인 대기 건수 |
| 메인으로 | / (링크) | home | - |

### 5.4 case.html 섹션 네비게이션

| 섹션 | 표시 조건 | 상호작용 |
|------|----------|---------|
| 대상자 정보 | 항상 | 읽기 전용 |
| AI 대화 요약 | conversationSummary 존재 시 | 읽기 전용 |
| 상태 스테퍼 | 항상 | "다음 단계" 버튼 (current 단계) |
| 처리 메모 | 항상 | 메모 입력 + 추가 |
| 서비스 계획 | servicePlan 존재 시 | 읽기 전용 |
| 연계 요청 | 항상 | 목록 조회 + 새 요청 생성 |
| 배정 근거 | assignmentRationale 존재 시 | 읽기 전용 |
| AI 상담 | 항상 | 역할 선택 + 질문 입력/빠른 질문 |
| 연계 체인 | chain 존재 시 | 읽기 전용 |
| 전화 버튼 | 항상 | tel: 링크 |

---

## 6. 반응형 레이아웃

### code.html 모바일 (<768px)

```
┌─────────────────────┐
│ [≡] 로고     [서랍] │  ← 햄버거 메뉴
│─────────────────────│
│                     │
│  히어로 타이틀       │
│  [마이크][입력][전송] │
│                     │
│  ┌───────────────┐  │
│  │ Stepper 카드 1 │  │  ← 1열
│  └───────────────┘  │
│  ┌───────────────┐  │
│  │ Stepper 카드 2 │  │
│  └───────────────┘  │
│                     │
│        마이크        │  ← 플로팅 마이크
└─────────────────────┘
```

### code.html 데스크톱 (>=768px)

```
┌───────────────────────────────────────────────┐
│ 로고    전체서비스  FAQ  내서랍  [전화문의]     │
│───────────────────────────────────────────────│
│                                               │
│            히어로 타이틀                        │
│       [마이크][     입력창     ][전송]         │
│       [칩1] [칩2] [칩3] [칩4]                 │
│                                               │
│  ┌──────────────────┐ ┌──────────────────┐    │
│  │  Stepper 카드 1   │ │  Stepper 카드 2   │   │  ← 2열
│  └──────────────────┘ └──────────────────┘    │
│                                               │
│  ① 상담 ─── ② 자격 ─── ③ 배정 ─── ④ 제공    │  ← 가로 연결선
└───────────────────────────────────────────────┘
```

### admin.html 데스크톱 (>=1024px)

```
┌──────────┬────────────────────────────────────┐
│          │  [≡]  현황판              14:30    │  ← 탑바
│ 사이드바  │──────────────────────────────────── │
│ (240px)  │  [KPI1] [KPI2] [KPI3] [KPI4]     │  ← KPI 카드
│          │──────────────────────────────────── │
│ 현황판 ✓ │  [접수] [확인] [연락] [연결] [완료] │  ← 칸반 5컬럼
│ 상담요청  │  │카드│ │카드│ │카드│ │카드│ │카드│ │
│ 분석     │──────────────────────────────────── │
│ 연계조정  │  [14일 접수 추이 차트]              │  ← Chart.js
│          │                                    │
│ 메인으로  │                                    │
└──────────┴────────────────────────────────────┘
```

### admin.html 모바일 (<1024px)

```
┌─────────────────────────┐
│ [≡] 현황판       14:30  │  ← 사이드바 숨김
│─────────────────────────│
│ [KPI1] [KPI2]           │  ← 2열 그리드
│ [KPI3] [KPI4]           │
│─────────────────────────│
│ [접수]                  │  ← 칸반 세로 스택
│ │카드│                  │
│ [확인]                  │
│ │카드│                  │
│ ...                     │
└─────────────────────────┘
```

### case.html (모바일 최적화, max-w-lg)

```
┌─────────────────────────┐
│  상담 처리 (녹색 헤더)   │
│─────────────────────────│
│  대상자 정보 (카드)      │
│  AI 대화 요약           │
│  [접수]-[확인]-...-[완료] │ ← 스테퍼
│  [다음 단계로]           │
│─────────────────────────│
│  처리 메모              │
│  [입력] [추가]          │
│─────────────────────────│
│  연계 요청              │
│  [연계 요청하기]         │
│─────────────────────────│
│  AI 상담                │
│  [배정근거][처리방안]...  │
│  [입력] [전송]          │
│─────────────────────────│
│  [대상자에게 전화]       │
└─────────────────────────┘
```
