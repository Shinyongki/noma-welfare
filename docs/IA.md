# IA (Information Architecture)
# 노마(Noma) 정보 아키텍처

---

## 1. 사이트맵

```
노마(Noma) 복지 내비게이터
│
├── 🏠 메인 (/)
│   │
│   ├── [헤더] ─────────────────────────────────────────────
│   │   ├── 로고 (PASS + 경상남도사회서비스원)
│   │   ├── GNB (데스크톱)
│   │   │   ├── 전체 서비스 → #browse-section 스크롤
│   │   │   ├── 자주 묻는 질문 (예정)
│   │   │   ├── 내 서랍 → 서랍 패널 열기
│   │   │   └── 전화 문의 → tel:0552308200
│   │   └── 모바일 메뉴 (햄버거)
│   │       └── 동일 메뉴 항목
│   │
│   ├── [히어로] ────────────────────────────────────────────
│   │   ├── 타이틀 + 서브타이틀
│   │   ├── 검색 입력창
│   │   │   ├── 마이크 버튼 (STT)
│   │   │   ├── 텍스트 입력
│   │   │   └── 전송 버튼
│   │   └── 예시 칩 (프리셋 검색어 4개)
│   │       ├── "#퇴원 후 돌봄이 필요해요"
│   │       ├── "#스마트 건강관리"
│   │       ├── "#긴급 돌봄"
│   │       └── "#독거 어르신 안전"
│   │
│   ├── [검색 결과] (검색 후 표시) ──────────────────────────
│   │   ├── AI 응답 요약 (마크다운 렌더링)
│   │   ├── 인라인 상담 신청 카드 (대화형 신청 완료 시)
│   │   │   ├── 성공: 초록색 확인 카드 (신청자명, 서비스명, 연락처)
│   │   │   └── 실패: 빨간색 에러 카드 (카드 버튼 사용 안내)
│   │   ├── 추천 서비스 카드 (최대 5개)
│   │   │   └── Stepper 카드 (상세 → 아래 참조)
│   │   ├── 새로 질문하기 버튼
│   │   └── 추가 안내
│   │       ├── "전체 서비스 둘러보기" 버튼
│   │       └── "대표전화 055-230-8200" 버튼
│   │
│   ├── [초기 플레이스홀더] (검색 전 표시) ──────────────────
│   │   └── 카테고리 미리보기 카드 3개
│   │       ├── 긴급돌봄 지원
│   │       ├── AI 스마트 돌봄
│   │       └── 장애인 지원 서비스
│   │
│   ├── [전체 서비스 브라우징] ───────────────────────────────
│   │   ├── 카테고리 탭
│   │   │   ├── 🩷 공공돌봄 (n건)
│   │   │   ├── 🤝 민간지원 (n건)
│   │   │   └── 🏛️ 국공립시설 (n건)
│   │   └── 서비스 리스트
│   │       └── 서비스 항목 (클릭 → 상세 펼침)
│   │           ├── 서비스명 + 요약
│   │           ├── [펼침] 지원 대상
│   │           ├── [펼침] 지원 내용
│   │           ├── [펼침] 신청 방법
│   │           ├── [펼침] 문의처
│   │           ├── [펼침] 상담 신청 버튼
│   │           └── 북마크 버튼
│   │
│   ├── [서비스 이용 경로] ──────────────────────────────────
│   │   ├── ① 상담 및 신청
│   │   ├── ② 자격 확인
│   │   ├── ③ 전담 인력 배정
│   │   └── ④ 서비스 제공
│   │
│   └── [푸터] ──────────────────────────────────────────────
│       ├── 기관 정보 (주소, 대표전화)
│       └── 링크 (개인정보처리방침, 이용약관, 사이트맵)
│
├── 🎤 플로팅 마이크 (모바일, 화면 우하단 고정)
│   └── 탭 → 음성 입력 시작/정지
│
├── 📋 내 서랍 패널 (우측 슬라이드)
│   ├── 저장된 서비스 목록
│   │   └── 서비스 항목
│   │       ├── 서비스명 + 요약 + 담당 기관
│   │       ├── 상담 신청 버튼
│   │       └── 삭제 버튼
│   ├── 전체 비우기 버튼
│   └── 빈 상태: "아직 담아둔 서비스가 없어요"
│
├── 📝 상담 신청 모달 (카드 버튼 경로)
│   ├── Step 1: 성함 입력
│   ├── Step 2: 연락처 입력
│   ├── Step 3: 신청 완료 확인 (4초 후 자동 복귀)
│   └── Step 4: 오류 안내
│
├── 💬 대화형 상담 신청 (음성/텍스트 대화 경로)
│   ├── AI가 서비스 확인 → 성함 질문 → 전화번호 질문
│   ├── <noma-apply> 태그 → 자동 POST /api/service-request/connect
│   ├── 성공: 인라인 초록색 확인 카드
│   └── 실패: 인라인 빨간색 에러 카드 (카드 버튼 안내)
│
├── 📧 서비스 연계 요청 페이지 (/referral/:requestId)
│   ├── 원래 상담 요청 정보 표시
│   ├── 연계 대상 서비스 선택 (카테고리별 드롭다운)
│   ├── 연계 사유 입력
│   └── 연계 이메일 발송 → 연쇄 연계 지원
│
└── 🔒 동의 모달 (첫 북마크 시)
    ├── "서비스를 저장할까요?" 안내
    ├── "네, 저장할게요" → 동의 후 저장
    └── "괜찮아요" → 취소
```

---

## 2. 추천 서비스 카드 (Stepper) 상세 구조

```
┌─────────────────────────────────────────┐
│  [아이콘]                    [🔖북마크] │
│                                         │
│  서비스명 (h3, bold)                     │
│  한 줄 요약 (summary)                    │
│                                         │
│  ─── Stepper Timeline ───               │
│                                         │
│  ① ── 대상 확인 ──────────── ▼ (펼침)   │
│  │    "65세 이상 독거노인,              │
│  │     장애인, 한부모가정 등"            │
│  │                                      │
│  ② ── 신청 방법 ──────────── ▶ (접힘)   │
│  │                                      │
│  ③ ── 받는 혜택 ──────────── ▶ (접힘)   │
│  │                                      │
│  ④ ── 연락처 ────────────── ▶ (접힘)    │
│       [📞 055-230-8200]  ← tel: 링크   │
│                                         │
│  ┌─────────────────────────────────┐    │
│  │    이 서비스 상담 신청            │    │
│  └─────────────────────────────────┘    │
│  "버튼을 누르면 담당 기관에 정보가       │
│   전달되며, 2~3일 내 전화 연락드립니다"  │
└─────────────────────────────────────────┘
```

---

## 3. 화면 전환 흐름 (Screen Flow)

```
[초기 상태]                    [검색 결과 상태]
┌──────────────┐              ┌──────────────┐
│   헤더       │              │   헤더       │
│              │              │              │
│   히어로     │   검색 실행   │ 히어로(축소) │
│  (검색창)    │ ──────────→  │  (검색창)    │
│  (예시 칩)   │              │              │
│              │              │  AI 요약     │
│  플레이스홀더 │              │  Stepper카드 │
│  (3개 미리보기)│             │  추가 안내    │
│              │              │              │
│  전체 서비스  │              │  전체 서비스  │
│  이용 경로   │  ←────────── │  이용 경로   │
│  푸터        │  새로 질문하기 │  푸터        │
└──────────────┘              └──────────────┘
                                    │
                               카드 클릭
                                    │
                                    ▼
                              ┌──────────────┐
                              │  상담 신청    │
                              │  모달         │
                              │  ① 이름      │
                              │  ② 전화번호   │
                              │  ③ 완료      │
                              └──────────────┘

[대화형 신청 흐름 (카드 버튼 대신 대화로 신청)]

┌──────────────┐     이름 답변     ┌──────────────┐
│ AI 요약      │ ──────────────→  │ AI 요약      │
│ 서비스 카드   │     전화번호 답변  │ + 인라인     │
│ "신청할게요"  │ ──────────────→  │   확인 카드   │
└──────────────┘                  └──────────────┘
      │                                  │
 AI가 이름 질문                    <noma-apply> 자동 처리
 AI가 전화번호 질문                 → 이메일 발송
                                  → 초록 확인 카드 표시
```

---

## 4. 데이터 구조

### 4.1 지식베이스 (CSV → 메모리)

```
welfareKB[]
├── 대분류:    공공돌봄 | 민간지원 | 국공립시설
├── 중분류:    서비스 하위 분류
├── 소분류:    세부 분류 (대부분 "분류없음")
├── 사업명:    서비스 공식 명칭        ← RAG 가중치 3
├── 키워드 태그: 검색용 해시태그       ← RAG 가중치 2
├── 지원 대상:  자격 요건 설명         ← RAG 가중치 1
├── 지원 내용:  혜택 상세 설명         ← RAG 가중치 1
├── 신청 방법:  신청 절차 안내
├── 문의처:    전화번호 + 부서명
└── 출처 URL:  공식 문서 링크
```

### 4.2 클라이언트 상태

```
SessionStorage (5분 만료)
├── nomaChatHistory:     대화 메시지 배열 (최대 8개)
└── nomaChatLastActive:  마지막 활동 타임스탬프

LocalStorage (영구)
├── nomaDrawerConsent:   서랍 사용 동의 여부
└── nomaDrawerItems:     저장된 서비스 배열
    └── [{ serviceName, summary, agency, savedAt }]
```

### 4.3 API 데이터 흐름

```
[사용자 입력]
     │
     ▼
"몸이 아파요"
     │
     ▼ split + stripKoreanSuffixes
["아파"]
     │
     ▼ expandSearchTerms (synonymMap)
["아파"] + 확장: ["질병","부상","돌봄","의료","긴급돌봄"]
     │
     ▼ 스코어링 (사업명×3, 키워드×2, 대상×1, 내용×1, 확장×0.7)
┌──────────────────────────────┬────────┐
│ 긴급돌봄지원사업              │ 11.9점 │
│ 창원시/김해시 종합재가센터     │  8.4점 │
│ 경상남도통합돌봄지원센터       │  7.7점 │
│ AI 온하나케어 스마트 돌봄      │  4.9점 │
│ 노인맞춤돌봄지원 광역관리      │  4.2점 │
└──────────────────────────────┴────────┘
     │
     ▼ Gemini AI (시스템 프롬프트 + RAG 컨텍스트)
     │
     ▼ SSE 스트리밍 → 텍스트 + <noma-card> JSON + <noma-apply> JSON
     │
     ▼ 파싱 → AI 요약 렌더링 + Stepper 카드 렌더링
     │
     ▼ parseNomaApply() → 자동 신청 POST → 인라인 확인/에러 카드
```

---

## 5. 네비게이션 구조

### 5.1 GNB (Global Navigation Bar)

| 메뉴 | 동작 | 위치 |
|------|------|------|
| 전체 서비스 | 브라우징 섹션으로 스크롤 | 헤더 |
| 자주 묻는 질문 | (예정) | 헤더 |
| 내 서랍 (뱃지) | 우측 서랍 패널 열기 | 헤더 |
| 전화 문의 | `tel:0552308200` 전화 연결 | 헤더 |

### 5.2 컨텍스트 네비게이션

| 트리거 | 목적지 | 발생 위치 |
|--------|-------|----------|
| 예시 칩 클릭 | 해당 쿼리로 검색 실행 | 히어로 |
| 플레이스홀더 카드 클릭 | 해당 키워드로 검색 실행 | 초기 화면 |
| "전체 서비스 둘러보기" | 브라우징 섹션 스크롤 | 검색 결과 하단 |
| "새로 질문하기" | 초기 상태로 리셋 | 검색 결과 상단 |
| 카드 "상담 신청" | 상담 신청 모달 열기 | 서비스 카드 |
| 카드 "북마크" | 내 서랍에 저장 | 서비스 카드 |
| 전화번호 탭 | 전화 앱 연결 | 카드 연락처 단계 |

---

## 6. 반응형 레이아웃

### 모바일 (<768px)

```
┌─────────────────────┐
│ [≡] 로고     [서랍] │  ← 햄버거 메뉴
│─────────────────────│
│                     │
│  히어로 타이틀       │
│  [🎤][  입력  ][➔]  │
│                     │
│  ┌───────────────┐  │
│  │ Stepper 카드 1 │  │  ← 1열
│  └───────────────┘  │
│  ┌───────────────┐  │
│  │ Stepper 카드 2 │  │
│  └───────────────┘  │
│                     │
│        🎤           │  ← 플로팅 마이크
└─────────────────────┘
```

### 데스크톱 (≥768px)

```
┌───────────────────────────────────────────────┐
│ 로고    전체서비스  FAQ  내서랍  [전화문의]     │
│───────────────────────────────────────────────│
│                                               │
│            히어로 타이틀                        │
│       [🎤][     입력창     ][➔]               │
│       [칩1] [칩2] [칩3] [칩4]                 │
│                                               │
│  ┌──────────────────┐ ┌──────────────────┐    │
│  │  Stepper 카드 1   │ │  Stepper 카드 2   │   │  ← 2열
│  └──────────────────┘ └──────────────────┘    │
│                                               │
│  ① 상담 ─── ② 자격 ─── ③ 배정 ─── ④ 제공    │  ← 가로 연결선
└───────────────────────────────────────────────┘
```
